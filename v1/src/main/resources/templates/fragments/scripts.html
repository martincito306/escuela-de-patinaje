<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<body>
    <!-- Fragment: Scripts (Bootstrap + JavaScript personalizado) -->
    <div th:fragment="scripts">
        <!-- Bootstrap JS -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
        
        <!-- Script para cargar datos dinámicos -->
        <script>
            // Cargar programas desde API
            async function cargarProgramas() {
                try {
                    const response = await fetch('/api/programas');
                    const programas = await response.json();
                    
                    const container = document.getElementById('programasContainer');
                    container.innerHTML = programas.slice(0, 3).map(programa => `
                        <div class="col-md-4">
                            <div class="card shadow h-100 border-0">
                                <div class="card-body p-4">
                                    <div class="text-center mb-3">
                                        <i class="fas ${programa.icono} fa-4x text-warning"></i>
                                    </div>
                                    <h5 class="card-title fw-bold text-center">${programa.nombre}</h5>
                                    <p class="card-text">${programa.descripcion}</p>
                                    <ul class="list-unstyled">
                                        <li class="mb-2"><i class="fas fa-check text-success me-2"></i>Edad: ${programa.edadMinima}-${programa.edadMaxima} años</li>
                                        <li class="mb-2"><i class="fas fa-check text-success me-2"></i>Duración: ${programa.duracion}</li>
                                        <li class="mb-2"><i class="fas fa-check text-success me-2"></i>Nivel: ${programa.nivel}</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    `).join('');
                } catch (error) {
                    console.error('Error al cargar programas:', error);
                }
            }
            
            // Cargar horarios desde API
            async function cargarHorarios() {
                try {
                    const response = await fetch('/api/horarios');
                    const horarios = await response.json();
                    
                    const tbody = document.querySelector('#horariosTable tbody');
                    tbody.innerHTML = horarios.slice(0, 4).map(horario => `
                        <tr>
                            <td><strong>${horario.dias}</strong></td>
                            <td>${horario.horaInicio} - ${horario.horaFin}</td>
                            <td><span class="badge bg-warning">${horario.nivel}</span></td>
                            <td>${horario.instructor}</td>
                        </tr>
                    `).join('');
                } catch (error) {
                    console.error('Error al cargar horarios:', error);
                }
            }
            
            // Manejar formulario de contacto
            document.getElementById('contactForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const formData = {
                    nombre: document.getElementById('nombre').value,
                    email: document.getElementById('email').value,
                    telefono: document.getElementById('telefono').value,
                    asunto: document.getElementById('asunto').value,
                    mensaje: document.getElementById('mensaje').value
                };
                
                try {
                    const response = await fetch('/api/contacto', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(formData)
                    });
                    
                    const result = await response.json();
                    const alertDiv = document.getElementById('contactAlert');
                    
                    if (response.ok) {
                        alertDiv.className = 'alert alert-success mt-3';
                        alertDiv.textContent = '¡Mensaje enviado con éxito! Te contactaremos pronto.';
                        alertDiv.style.display = 'block';
                        this.reset();
                    } else {
                        alertDiv.className = 'alert alert-danger mt-3';
                        alertDiv.textContent = 'Error al enviar el mensaje. Por favor, intenta nuevamente.';
                        alertDiv.style.display = 'block';
                    }
                    
                    setTimeout(() => {
                        alertDiv.style.display = 'none';
                    }, 5000);
                    
                } catch (error) {
                    console.error('Error:', error);
                    const alertDiv = document.getElementById('contactAlert');
                    alertDiv.className = 'alert alert-danger mt-3';
                    alertDiv.textContent = 'Error de conexión. Por favor, intenta nuevamente.';
                    alertDiv.style.display = 'block';
                }
            });
            
            // Cargar datos al cargar la página
            document.addEventListener('DOMContentLoaded', function() {
                cargarProgramas();
                cargarHorarios();
            });
        </script>
    </div>
    <!-- Fin fragment: scripts -->
</body>
</html>
